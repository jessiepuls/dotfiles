#!/bin/bash

# Setting environment variable for where brewfile can be found to make sure the script can find it
export HOMEBREW_BUNDLE_FILE=$HOME/.Brewfile

# Install Homebrew
if ! command -v brew &> /dev/null
then
  echo '🍺  Installing Homebrew'
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

  echo "👩‍💻 Setting environment variables"
  {{- if eq .chezmoi.os "darwin" }}
  eval "$(/opt/homebrew/bin/brew shellenv)"
  {{- else }}
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  {{- end }}
fi

# Install brew bundles
echo "🍻 Installing homebrew packages"
brew bundle install
brew bundle --force cleanup

# TODO: For some reason this command not found when running the script
# Add asdf plugins
echo "⌨️ Installing asdf packages"
asdf plugin update --all 
asdf plugin add terraform
asdf plugin add terragrunt
asdf plugin-add kubectl
asdf plugin-add helm

# reshim asdf in case there were updates
rm -rf ~/.asdf/shims && asdf reshim

# Install tools
asdf install